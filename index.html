<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JFT Combined Demo</title>
  <style>
/* =========================
   GLOBAL
========================= */
html, body {
  margin: 0;
  height: 100vh;
  overflow-x: hidden;
}

body {
  display: flex;
  font-family: Arial, Helvetica, sans-serif;
  background: #f4f4f4;
}

/* =========================
   SIDEBAR DESKTOP
========================= */
.sidebar {
  width: 70px;
  background: #e6e6e6;
  border-right: 1px solid #c9c9c9;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.side-section {
  flex: 1;
  background: #efefef;
  border-top: 1px solid #d0d0d0;
  border-bottom: 1px solid #d0d0d0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding-top: 6px;
  font-size: 12px;
  color: #444;
  cursor: pointer;
}

.side-section:hover {
  background: #e0e0e0;
}

.side-label {
  font-size: 12px;
  margin-bottom: 4px;
}

.side-track {
  width: 10px;
  flex: 1;
  background: #dcdfe3;
  border-radius: 999px;
  position: relative;
  margin: 6px 0 10px;
}

.side-fill {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: #6b9f34;
  border-radius: 999px;
  height: 0%;
  transition: height 0.3s ease, width 0.3s ease;
}

/* =========================
   STEP COLUMN DESKTOP
========================= */
.step-column {
  width: 80px;
  background: #f0f0f0;
  border-right: 1px solid #d0d0d0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 15px 0;
  gap: 12px;
  height: 100vh;
  overflow-y: auto;
}

.step {
  width: 52px;
  height: 40px;
  background: #d0d0d0;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 15px;
  border-radius: 6px;
  cursor: pointer;
  flex-shrink: 0;
}

.step.answered { background: #6aa037; }
.step.done { background: #CD5C5C; }

.step.active {
  position: relative;
  background: #4f7f22;
}

.step.active::after {
  content: "";
  position: absolute;
  right: -12px;
  top: 0;
  border-top: 15px solid transparent;
  border-bottom: 15px solid transparent;
  border-left: 12px solid #4f7f22;
}

/* =========================
   MAIN AREA
========================= */
.main {
  flex: 1;
  padding: 30px;
  overflow-y: auto;
  height: 100vh;
}

.screen { display: none; }
.screen.active {
  display: flex;
  justify-content: center;
  align-items: flex-start;
}

.container {
  width: 900px;
  max-width: 900px;
  background: #ffffff;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  overflow: hidden;
}

/* =========================
   HEADER
========================= */
.header {
  background: #1f4fa3;
  color: white;
  padding: 16px 24px;
  font-size: 20px;
  font-weight: bold;
}

.exam-header {
  background: linear-gradient(135deg, #1f4fa3, #163c82);
  color: white;
  padding: 14px 20px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.exam-title { font-size: 18px; font-weight: bold; }

.exam-sub {
  font-size: 13px;
  opacity: 0.9;
  display: flex;
  align-items: center;
  gap: 6px;
}

.exam-sub .dot { font-size: 10px; opacity: 0.6; }

/* =========================
   QUESTION AREA
========================= */
.content { padding: 24px; }

.question-number {
  font-size: 14px;
  color: #555;
  margin-bottom: 10px;
}

.question-text {
  font-size: 18px;
  margin-bottom: 20px;
  line-height: 1.6;
}

.question-image {
  width: 100%;
  max-height: 220px;
  min-height: 160px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 12px 0 16px;
}

.question-image img {
  max-width: 100%;
  max-height: 220px;
  object-fit: contain;
}
.container.no-image-question .question-image {
  display: none;
}


/* =========================
   CHOICES
========================= */
.choices {
  list-style: none;
  padding: 0;
}

.choices li { margin-bottom: 12px; }

.choices button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #cfd8dc;
  background: #f9fbfd;
  cursor: pointer;
  text-align: left;
  transition: all 0.2s ease;
}

.choices button:hover {
  background: #e3f2fd;
  border-color: #1f4fa3;
}

.choices button.selected {
  background: #6aa037;
  color: white;
  border-color: #4f7f22;
}

/* =========================
   IMAGE GRID CHOICES
========================= */
.choices.image-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
}

.choices.image-grid button {
  height: 140px;
  padding: 6px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.choice-img-box {
  flex: 1;
  width: 100%;
  background: #f3f3f3;
  border-radius: 6px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.choice-img-box img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.choice-label {
  font-size: 12px;
  text-align: center;
  margin-top: 4px;
}

/* =========================
   NAVIGATION
========================= */
.navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 25px;
}

.nav-btn {
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #1f4fa3;
  color: white;
}

/* =========================
   RESULT MODE
========================= */
body.result-mode .sidebar,
body.result-mode .step-column {
  display: none !important;
}

body.result-mode {
  display: block !important;
  overflow: hidden !important;
}

body.result-mode .main {
  margin: 0 !important;
  padding: 0 !important;
  height: 100vh !important;
  width: 100vw !important;
}

body.result-mode #resultScreen {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  height: 100vh !important;
  overflow: hidden !important;
}

body.result-mode .certificate {
  width: 100%;
  max-width: 900px;
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* =========================
   MOBILE
========================= */
@media (max-width: 768px) {

  body { flex-direction: column; }

  .sidebar {
    width: 100vw;
    height: 56px;
    flex-direction: row;
    justify-content: space-around;
    align-items: center;
    border-right: none;
    border-bottom: 1px solid #d0d0d0;
  }

  .side-track {
    width: 70%;
    height: 4px;
    margin-top: 4px;
  }

  .side-fill {
    height: 100%;
  }

  .step-column {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 56px;
    flex-direction: row;
    overflow-x: auto;
    overflow-y: hidden;
    border-right: none;
    border-top: 1px solid #ccc;
  }

  .step {
    width: 40px;
    height: 40px;
    font-size: 14px;
  }

  .step.active::after { display: none; }

  .main {
    margin-top: 56px;
    padding: 12px;
  }

  .question-image {
    max-height: 160px;
  }

  .question-image img {
    max-height: 160px;
  }

  .choices.image-grid button {
    height: 110px;
  }
}

/* =========================
   AUDIO LOCK
========================= */
audio::-webkit-media-controls-timeline {
  pointer-events: none;
}

audio::-webkit-media-controls-seek-back-button,
audio::-webkit-media-controls-seek-forward-button {
  display: none;
}


  </style>
</head>
<body>

  <!-- SIDEBAR -->
<div class="sidebar">
<div class="side-section" onclick="goToSection('gra')">
  <div class="side-label">Grammar</div>
  <div class="side-track">
    <div class="side-fill" id="graProgress"></div>
  </div>
</div>

<div class="side-section" onclick="goToSection('scri')">
  <div class="side-label">Script an...</div>
  <div class="side-track">
    <div class="side-fill" id="scriProgress"></div>
  </div>
</div>

<div class="side-section" onclick="goToSection('co')">
  <div class="side-label">Conversation</div>
  <div class="side-track">
    <div class="side-fill" id="coProgress"></div>
  </div>
</div>

<div class="side-section" onclick="goToSection('list')">
  <div class="side-label">Listening</div>
  <div class="side-track">
    <div class="side-fill" id="listProgress"></div>
  </div>
</div>

<div class="side-section" onclick="goToSection('rea')">
  <div class="side-label">Reading</div>
  <div class="side-track">
    <div class="side-fill" id="reaProgress"></div>
  </div>
</div>

</div>

  <!-- STEP COLUMN -->
<div class="step-column" id="stepColumn"></div>

  <!-- MAIN -->
   <div id="resultScreen" class="screen">
  <div class="certificate">

    <div class="header">
      <h1>Sertifikat rumah</h1>
      <h2>wkwkw</h2>
    </div>

    <div class="profile-section">
      <div class="photo">
        <img src="https://i.pinimg.com/736x/cb/9d/59/cb9d591f82200dabe76083716913c221.jpg" alt="Profile">
      </div>
      <div class="info">
        <p><strong>Name:</strong> Asep pacul</p>
        <p><strong>Negara:</strong> Wakanda</p>
      </div>
    </div>
    <div class="score-section">
      <div class="score-title" id="totalScoreText"></div>
      <div class="bar-container">
        <div class="marker" id="scoreMarker"></div>
      </div>
      <div class="bar-labels">
        <span>0</span>
        <span>200 (Minimal bos)</span>
        <span>250</span>
      </div>
    </div>
    <div class="section-scores" id="sectionScores"></div>
  </div>
</div>
  <div class="main">
    <div id="intro" class="screen">
      <div class="question-box">
      </div>
    </div>
<div id="quiz" class="screen">
      <div class="container">
<div class="header exam-header">
  <div class="exam-title">Latihan Soal</div>
  <div class="exam-sub">
    <span id="examSection">Grammar</span>
    <span class="dot">â€¢</span>
    <span id="examProgress">Question 1 / 13</span>
  </div>
</div>
        <div class="content">
          <div class="question-number" id="qNumber"></div>
          <div class="audio-player" id="audioContainer"></div>
          <div class="question-image" id="imageContainer"></div>
          <div class="question-text" id="questionText"></div>
          <ul class="choices" id="choices"></ul>
          <div class="result" id="result"></div>
          <div class="navigation">
            <button class="nav-btn" onclick="prevQuestion()">â—€ Previous</button>
            <button class="nav-btn" onclick="nextQuestion()">Next â–¶</button>
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
// =====================
// 1ï¸âƒ£ HELPER FUNCTIONS
// =====================
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function shuffleChoices(question) {

  // ðŸ”¥ JIKA bukan kanji/hiragana, JANGAN DIAPA-APAIN
  if (
    !question.choices ||
    typeof question.choices[0] === "string" ||
    !question.choices[0][ACTIVE_SCRIPT]
  ) {
    return;
  }

  const combined = question.choices.map((choice, index) => ({
    text: choice[ACTIVE_SCRIPT],
    isCorrect: index === question.correct
  }));

  for (let i = combined.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [combined[i], combined[j]] = [combined[j], combined[i]];
  }

  question.choices = combined.map(item => item.text);
  question.correct = combined.findIndex(item => item.isCorrect);
}

</script>

<script>
const SCRIPTS = ["kanji", "hiragana"];
const ACTIVE_SCRIPT = SCRIPTS[Math.floor(Math.random() * SCRIPTS.length)];
const MAX_AUDIO_PLAY = 2;
const audioPlaysPerQuestion = {}; // ðŸ”¥ kunci per soal
let audioLocked = false;
function renderQuestionText(q) {
  // ðŸ”¥ kalau tidak ada text, kembalikan string kosong
  if (!q.text) return "";

  if (!q.target) return q.text;

  const oppositeScript =
    ACTIVE_SCRIPT === "kanji" ? "hiragana" : "kanji";

  return q.text.replace(
    "{target}",
    q.target[oppositeScript]
  );
}
const sections = {
    gra: [
{
  image: "https://i.pinimg.com/736x/36/59/f5/3659f5fba5f3b9dae5b9f49ecdc30cbb.jpg",        // â¬…ï¸ gambar
  choices: [
    { kanji: "é‹è»¢è»Š", hiragana: "ã†ã‚“ã¦ã‚“ã—ã‚ƒ" },
    { kanji: "è‡ªè»¢è»Š", hiragana: "ã˜ã¦ã‚“ã—ã‚ƒ"},
    { kanji: "è‡ªå‹•è²©å£²æ©Ÿ", hiragana: "ã˜ã©ã†ã¯ã‚“ã°ã„ã" }
  ],
  correct: 1
}
,
{
  text: "({target})ã®ã§æ‰‹ä¼ãˆã¾ã›ã‚“ã€‚",
  target: { kanji: "å¿™ã—ã„", hiragana: "ã„ããŒã—ã„" },
  choices: [
      { kanji: "å¿™ã—ã„", hiragana: "ã„ããŒã—ã„" },
      { kanji: "æ¥½ã—ã„", hiragana: "ãŸã®ã—ã„" },
      { kanji: "é›£ã—ã„", hiragana: "ã‚€ãšã‹ã—ã„" }
    ],
  correct: 0
}
  ,{
  image: "https://i.pinimg.com/1200x/ba/41/8f/ba418ff564e83b0260d9c61112839731.jpg",        // â¬…ï¸ gambar
    choices: [
      { kanji: "ä¹—ã›ã‚‹", hiragana: "ã®ã›ã‚‹" },
      { kanji: "ä»˜ã‘ã‚‹", hiragana: "ã¤ã‘ã‚‹" },
      { kanji: "æŽ›ã‘ã‚‹ ", hiragana: "ã‹ã‘ã‚‹" }
    ],
    correct: 1
  },
  {
    text: "ã‚ã¾ã„ã‚‚ã®ã¯ ({target})  ã§ã™ã€‚",
  target: { kanji: "è‹¦æ‰‹", hiragana: "ã«ãŒã¦" },
  choices: [
      { kanji: "è‹¥æ‰‹", hiragana: "ã˜ã‚ã˜ã‚" },
      { kanji: "è‰è‹¦", hiragana: "ãŠãŠã„" },
      { kanji: "è‹¦æ‰‹", hiragana: "ã«ãŒã¦" }
    ],
    correct: 2
  },
  {
    text: "æ˜¨æ—¥ã¯é›¨ãŒé™ã‚‹ã®ã§ã‚ã¾ã‚Š________",
    choices: [
      { kanji: "é¢ç™½ããªã‹ã£ãŸ", hiragana: "ãŠã‚‚ã—ã‚ããªã‹ã£ãŸ" },
      { kanji: "é¢ç™½ããªã‹ã£ãŸã§ã™", hiragana: "ãŠã‚‚ã—ã‚ããªã‹ã£ãŸã§ã™" },
      { kanji: "é¢ç™½ã„ ", hiragana: "ãŠã‚‚ã—ã‚ã„" }
    ],
    correct: 1
  },
  {
    text: "æ˜Žæ—¥ã¯ã„ã„({target})ã§ã—ã‚‡ã†ã€‚",
   target: { kanji: "å¤©æ°—", hiragana: "ã¦ã‚“ã" },
  choices: [
      { kanji: "å¤©æ°—", hiragana: "ã¦ã‚“ã" },
      { kanji: "æ°—å¤©", hiragana: "ã¦ã‚“ãŽ" },
      { kanji: "é›»æ°—", hiragana: "ã§ã‚“ãŽ" }
    ],
    correct: 0
  }
    ,{
  image: "https://i.pinimg.com/736x/d6/e0/64/d6e064493ac58565eae347554de5a796.jpg",        // â¬…ï¸ gambar
    choices: [
      { kanji: "é ­", hiragana: "ã‚ãŸã¾" },
      { kanji: "ãŠè…¹", hiragana: "ãŠãªã‹" },
      { kanji: "ä½“ ", hiragana: "ã‹ã‚‰ã " }
    ],
    correct: 1
  },
  {
    text: "________ã‹ã‚Œã®ã•ã„ãµã¯æ­©ã„ã¦ã„ã‚‹ã¨ãã«å–ã‚‰ã‚ŒãŸã‹ã‚‚ã—ã‚Œãªã„",
    choices: [
      { kanji: "ã‚‚ã—ã‹ã—ãŸã‚‰", hiragana: "ã‚‚ã—ã‹ã—ãŸã‚‰" },
      { kanji: "ã‹ãªã‚‰ãš", hiragana: "ã‹ãªã‚‰ãš" },
      { kanji: "ã§ãã‚Œã°", hiragana: "ã§ãã‚Œã°" }
    ],
    correct: 0
  },
  {
    text: "ãã£ã¨______ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚",
    choices: [
      { kanji: "ãƒ†ãƒ¼ãƒ–ãƒ«", hiragana: "ãƒ†ãƒ¼ãƒ–ãƒ«" },
      { kanji: "ã¿ã¤ã‘ã‚‹", hiragana: "ã¿ã¤ã‘ã‚‹" },
      { kanji: "é–“ã«åˆã‚ã›ã‚‹", hiragana: "é–“ã«åˆã‚ã›ã‚‹" }
    ],
    correct: 1
  },
  {
    text: "æ˜Žæ—¥ã¯({target})ã‚’ã¿ã«ãã¾ã›ã‚“ã‹",
   target: { kanji: "æ˜ ç”»", hiragana: "ãˆã„ãŒ" },
  choices: [
      { kanji: "æ˜ ç”»", hiragana: "ãˆã„ãŒ" },
      { kanji: "ç”»æ˜ ", hiragana: "ãŒã£ã‹" },
      { kanji: "è‹±èªž", hiragana: "ãˆã„ã”" }
    ],
    correct: 0
  },
    {
    text: "ã‚ãã„ã ã‚ã¨ã§, ã‚·ãƒ£ãƒ¯ãƒ¼ã‚’________"  ,
   target: { kanji: "æµ´ã³ã¾ã™", hiragana: "ã‚ã³ã¾ã™" },
  choices: [
      { kanji: "æµ´ã³ã¾ã™", hiragana: "ã‚ã³ã¾ã™" },
      { kanji: "ä¹—ã‚Šã¾ã™", hiragana: "ã®ã‚Šã¾ã™" },
      { kanji: "è¡Œãã¾ã™", hiragana: "ãã¾ã™" }
    ],
    correct: 0
  },
      {
    text: "ä»Šã¯({target})ã«ã„ã¾ã™"  ,
   target: { kanji: "å›³æ›¸é¤¨", hiragana: "ã¨ã—ã‚‡ã‹ã‚“" },
  choices: [
      { kanji: "å›³æ›¸é¤¨", hiragana: "ã¨ã—ã‚‡ã‹ã‚“" },
      { kanji: "å­¦æ ¡", hiragana: "ãŒã£ã“ã†" },
      { kanji: "å®¶", hiragana: "ã„ãˆ" }
    ],
    correct: 0
  },
  {
    text: "({target})",
   target: { kanji: "é‹ã‚“ã§", hiragana: "ã¯ã“ã‚“ã§" },
  choices: [
      { kanji: "é‹ã‚“ã§", hiragana: "ã¯ã“ã‚“ã§" },
      { kanji: "ã‚ˆã‹ã£ãŸ", hiragana: "ã‚ˆã‹ã£ãŸ" },
      { kanji: "ã¯ã“ã‚“ã§", hiragana: "ã¯ã“ã‚“ã§" }
    ],
    correct: 1
  }
],
scri: [
  {
    text:
    "A: ã‚ãªãŸã®ã—ã‚…ã¿ã¯ãªã‚“ã§ã™ã‹\n" +
    "B: ã»ã‚“ã‚’ã‚ˆã‚€ã“ã¨ã§ã™\n" +
    "A: ã©ã‚“ãªæœ¬ã§ã™ã‹\n" +
    "B: ______ æ­´å²ã®æœ¬ã§ã™",
    choices: [
      { kanji: "ç‰¹ã«", hiragana: "ã¨ãã«" },
      { kanji: "ç¢ºã‹ã«", hiragana: "ãŸã—ã‹ã«" },
      { kanji: "å…¶ã®å„˜ã«", hiragana: "ãã®ã¾ã¾ã«" }
    ],
    correct: 0
  }
      ,{
  image: "https://i.pinimg.com/1200x/51/dc/b3/51dcb364663c61ad4866315ad36820b4.jpg",        // â¬…ï¸ gambar
    choices: [
      { kanji: "å¤šã„ã™ãŽ", hiragana: "ãŠãŠã„ã™ãŽ" },
      { kanji: "å¤šãŠã„ã™ãŽ", hiragana: "ãŠãŠã™ãŽ" },
      { kanji: "å¤šã™ãŽ", hiragana: "ãŠã™ãŽ" }
    ],
    correct: 1
  },
  {
    text: "äºˆå®šã„ã®ã»ã‹ã®ã²ã¨ãŒ_________",
    choices: [
      { kanji: "ãŠçŸ¥ã‚‰ã›ã™ã‚‹ãŸã‚ã«", hiragana: "ãŠã—ã‚‰ã›ã‚‹ãŸã‚ã«" },
      { kanji: "ãŠçŸ¥ã‚‰ã›", hiragana: "ãŠã—ã‚‰ã›" },
      { kanji: "çŸ¥ã‚Œã°", hiragana: "ãŠã—ã‚Œã°" }
    ],
    correct: 0
  },
  {
    text: "ã“ã‚Œã¯ãƒãƒŠãƒŠã®________, ã©ã†ãžã€‚",
    choices: [
      { kanji: "æ–™ç†ã§ã—ãŸ", hiragana: "ã‚Šã‚‡ã†ã‚Šã§ã—ãŸ" },
      { kanji: "æ–™ç†ã§ã™", hiragana: "ã‚Šã‚‡ã†ã‚Šã§ã™" },
      { kanji: "æ–™ç†ã—ã¾ã™", hiragana: "ã‚Šã‚‡ã†ã‚Šã¾ã™" }
    ],
    correct: 2
  },
  {
    text:
    "A: ã‚ã‚Šã•ã‚“ã€ã„ã¹ã‚“ã¨ã®ã‚ˆã¦ã„ãŒã‹ã‚ã£ãŸã“ã¨ã‚’ã—ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ\n" +
    "B: ã¸ãˆã€ã‹ã‚ã£ãŸã‚“ã§ã™ã‹ï¼Ÿãƒ¼ãƒ¼ã—ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n" +
    "A: ã˜ã‚ƒã‚ã€ã‚ˆã¦ã„ã®ã»ã‹ã®ã²ã¨ã«ã€‚ã€‚ã€‚ãŸã‚ã«ã€‚ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã¤ãŸãˆã¦ãã ã•ã„ã€‚\n" +
    "B: ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚",
    choices: [
      { kanji: "ãŠä¸–è©±ã«ãªã‚‹", hiragana: "ãŠã›ã‚ã«ãªã‚‹" },
      { kanji: "ãŠçŸ¥ã‚‰ã›ã‚‹", hiragana: "ãŠã—ã‚‰ã›ã‚‹" },
      { kanji: "é€ã‚‹", hiragana: "ãŠãã‚‹" }
    ],
    correct: 1
  },
  {
    text: "A: ã™ã¿ã¾ã›ã‚“, ã“ã“ã¯_________ ?? \n" +
    "B: æ±äº¬ã§ã™",
    choices: [
      { kanji: "ã„ã¤ã§ã™ã‹", hiragana: "ã„ã¤ã§ã™ã‹" },
      { kanji: "ä½•ã§ã™ã‹", hiragana: "ãªã‚“ã§ã™ã‹" },
      { kanji: "ã©ã“ã§ã™ã‹", hiragana: "ã©ã“ã§ã™ã‹" }
    ],
    correct: 2
  },
  {
    text: "ã‚¢ãƒ‹ã•ã‚“ã¯____________?, \n" +
    "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™",
    choices: [
      { kanji: "çµå©š ", hiragana: "ã‘ã£ã“ã‚“" },
      { kanji: "çµå©šã™ã‚‹ã‚ˆã†ã«", hiragana: "ã‘ã£ã“ã‚“ã™ã‚‹ã‚ˆã†ã«" },
      { kanji: "çµå©šã—ãŸãã†ã§ã™", hiragana: "ã‘ã£ã“ã‚“ã—ãŸãã†ã§ã™" }
    ],
    correct: 2
  },
  {
    text: "A: ãŠãã‚ƒãã•ã¾ã¯ã©ã‚“ãªã•ã„ã¾ã™ã‹ \n" +
    "B: ã‚¸ãƒ¥ãƒ¼ã‚¹________???",
    choices: [
      { kanji: "ã—ã¦ã‚‚ã‚‰ãˆã¾ã›ã‚“ã‹", hiragana: "ã—ã¦ã‚‚ã‚‰ãˆã¾ã›ã‚“ã‹" },
      { kanji: "ã—ã¦ã„ã¾ã™", hiragana: "ã—ã¦ã„ã¾ã™" },
      { kanji: "ãŠé¡˜ã„ã—ã¾ã™", hiragana: "ãŠé¡˜ã„ã—ã¾ã™" }
    ],
    correct: 2
  },
  {
    text: "A: ã„ã¤ã„ã—ã‚‡ã«ã‚µãƒƒã‚«ãƒ¼ã‚’ã—ã¾ã™ã‹ \n" +
    "B: ã“ã‚Œã‹ã‚‰________???",
    choices: [
      { kanji: "ã©ã†ã—ã¾ã™ã‹", hiragana: "ã©ã†ã—ã¾ã™ã‹" },
      { kanji: "ã©ã†ã—ãŸã‚“ã§ã™ã‹", hiragana: "ã©ã†ã—ãŸã‚“ã§ã™ã‹" },
      { kanji: "ã©ã†ã§ã™ã‹", hiragana: "ã©ã†ã§ã™ã‹" }
    ],
    correct: 1
  },
  {
    text: "({target})ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã¾ã‚Šã€‚",
   target: { kanji: "æ˜¨æ—¥", hiragana: "ãã®ã†" },
  choices: [
      { kanji: "é¢ç™½ããªã‹ã£ãŸ", hiragana: "ãŠã‚‚ã—ã‚ããªã‹ã£ãŸ" },
      { kanji: "é¢ç™½ããªã„", hiragana: "ãŠã‚‚ã—ã‚ããªã„" },
      { kanji: "é¢ç™½ã„", hiragana: "ãŠã‚‚ã—ã‚ã„" }
    ],
    correct: 0
  },
  {
    text: "ä»•äº‹ ã‚’ ã€‚ã€‚ã€‚ã€‚",
    choices: [
      { kanji: "ä¼‘ã‚“ã§ã‚‚ã„ã„ã§ã™ã‹?", hiragana: "ã‚„ã™ã‚“ã§ã‚‚ã„ã„ã§ã™ã‹?" },
      { kanji: "ä½•å‡¦", hiragana: "ã©ã“ã§ã™ã‹" },
      { kanji: "ä¼‘ã¿", hiragana: "ã‚„ã™ã¿" }
    ],
    correct: 2
  }
],

  co: [
{
  text: "æ—¥ã«ã»ã‚“ã” æœ¬èªžãŒã‚ã‹ã‚‰ãªã„ã¨ãã€ã©ã†è¨€ã„ã„ã¾ã—ãŸã‹ã€‚",
  audio: "https://www.irodori.jpf.go.jp/assets/data/starter/audio/02/X_[02-01]_kiku1.mp3",      // â¬…ï¸ suara
    choices: [
      { kanji: "ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“", hiragana: "ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“" },
      { kanji: "åˆ†ã‹ã‚Šã¾ã—ãŸ", hiragana: "ã‚ã‹ã‚Šã¾ã—ãŸ" },
      { kanji: "ã–ã„ã‚Šã‚…ã†ã‚«ãƒ¼ãƒ‰", hiragana: "ã‚¶ã‚¤ãƒªãƒ¥ã‚¦ ã‚«ãƒ¼ãƒ‰" }
    ],
  correct: 0
},
{
  text: "	ãƒ‘ã‚¦ãƒ­ã•ã‚“ã¯ã€ä½•ãªã‚“ã˜æ™‚ã«èµ·ãŠãã¾ã™ã‹ã€‚",
  audio: "https://www.irodori.jpf.go.jp/assets/data/starter/audio/09/X_[09-05]_kiku3.mp3",      // â¬…ï¸ suara
    choices: [
      { kanji: "8æ™‚ã˜ã”ã‚èµ·ãŠãã¾ã™ã€‚", hiragana: "ã¯ã¡ã˜ã”ã‚ãŠãã¾ã™" },
      { kanji: "2æ™‚ã˜ã«èµ·ãŠãã¾ã™", hiragana: "ã«ã˜ã«ãŠãã¾ã™" },
      { kanji: "8æ™‚ã˜ã”ã‚å¯ã­ã¾ã™ã€‚", hiragana: "ã¯ã¡ã˜ã”ã‚ã­ã¾ã™" }
    ],
  correct: 0
},
{
  text: "	ä½•ãªã«ã‚’æ³¨ã¡ã‚…ã†ã‚‚ã‚“æ–‡ã—ãŸã„ã§ã™ã‹ã€‚",
  audio: "https://www.irodori.jpf.go.jp/assets/data/starter/audio/06/X_[06-02]_kiku2.mp3",      // â¬…ï¸ suara
    choices: [
      { kanji: "ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼,ã¦ã‚Šã‚„ããƒãƒ¼ã‚¬ãƒ¼,ãƒ•ã‚£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¬ãƒ¼", hiragana: "ã¡ãƒ¼ãš" },
      { kanji: "ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼,ã¦ã‚Šã‚„ããƒãƒ¼ã‚¬ãƒ¼,ãƒ•ãƒ©ã‚¤ãƒ‰ãƒãƒ†ãƒˆãƒãƒ¼ã‚¬ãƒ¼", hiragana: "ã‚‚ã†ã„ã¡ã©ã€ãŠã­ãŒã„ã—ã¾ã™" },
      { kanji: "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼,ã¦ã‚Šã‚„ããƒãƒ¼ã‚¬ãƒ¼,ãƒ•ã‚£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¬ãƒ¼", hiragana: "ã‚‚ã†ã™ã“ã—ã€ã‚†ã£ãã‚Šã„ã„ã£ã¦ãã ã•ã„ã€‚" }
    ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-nanami-7-2026-02-13t08-51-56-744z_y9CQUMRS.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/f8/2b/95/f82b9571350bbf74ad38f8816186c7df.jpg", id: "ã•ã£ã‹ãƒ¼ã‚’ ã™ã‚‹" },
    { jp: "https://i.pinimg.com/1200x/2c/45/bd/2c45bdac6ce0841e6290276e2efd7da5.jpg", id: "ã«ã£ãã‚’ ã‹ã" },
    { jp: "https://i.pinimg.com/736x/b5/f2/f3/b5f2f35b207b78ee6ba34a9aef63b3e3.jpg", id: "ã™ã„ãˆã„ã‚’ ã™ã‚‹" },
  ],
  correct: 0
},
{
    audio: "https://www.irodori.jpf.go.jp/assets/data/starter/audio/15/X_[15-12]_kiku1.mp3",      // â¬…ï¸ suara
  text: "ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼ã¯ã€ã©ã“ã«ã‚ã‚Šã¾ã™ã‹ã€‚",
choices: [
  { img: "Screenshot 2026-02-12 181019.png", label: "A" },
  { img: "Screenshot 2026-02-12 181046.png", label: "B" },
  { img: "img/c.png", label: "C" },
  { img: "img/d.png", label: "D" }
],
correct: 2
},
{
  text: "	ã©ã‚“ãªå¤©ã¦ã‚“ãæ°—ã§ã™ã‹ã€‚",
  audio: "https://www.irodori.jpf.go.jp/assets/data/elementary01/audio/04/Y_[04-04]_kiku2.mp3",      // â¬…ï¸ suara
    choices: [
      { kanji: "æ™´ã‚Œï¼æ™´ã‚Œã‚‹ï¼ã„ã„å¤©æ°—", hiragana: "ã¯ã‚Œï¼ã¯ã‚Œã‚‹ï¼ã„ã„ã¦ã‚“ã" },
      { kanji: "é›¨ã‚ã‚ï¼é›¨ã‚ã‚ãŒé™ãµã‚‹", hiragana: "ã‚ã‚ï¼ã‚ã‚ãŒãµã‚‹" },
      { kanji: "é¢¨ã‹ãœï¼é¢¨ã‹ãœãŒå¹ãµã", hiragana: "ã‹ãœï¼ã‹ãœãŒãµã" }
    ],
  correct: 1
}
  ],

  list: [
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-nanami-7-2026-02-13t08-51-56-744z_y9CQUMRS.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/f8/2b/95/f82b9571350bbf74ad38f8816186c7df.jpg", id: "ã•ã£ã‹ãƒ¼ã‚’ ã™ã‚‹" },
    { jp: "https://i.pinimg.com/1200x/2c/45/bd/2c45bdac6ce0841e6290276e2efd7da5.jpg", id: "ã«ã£ãã‚’ ã‹ã" },
    { jp: "https://i.pinimg.com/736x/b5/f2/f3/b5f2f35b207b78ee6ba34a9aef63b3e3.jpg", id: "ã™ã„ãˆã„ã‚’ ã™ã‚‹" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-hyunsu-japanese-7-2026-02-13t10-06-08-375z_LDYmd6Z3.mp3",
    choices: [
      { kanji: "ã‚ãã‚‰-ã•ã‚“", hiragana: "ã‚ãã‚‰-ã•ã‚“" },
      { kanji: "ã¿ã‹-ã•ã‚“", hiragana: "ã¿ã‹-ã•ã‚“" },
      { kanji: "ãŸã‚ã†-ã•ã‚“", hiragana: "ãŸã‚ã†-ã•ã‚“" }
    ],
  correct: 1
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-keita-2-2026-02-13t15-11-15-117z_x8kPtM2q.mp3",
    choices: [
      { kanji: "ä¼šè­°å®¤", hiragana: "ã«ã²ã‚ƒãã”ã˜ã‚…ã†ãˆã‚“" },
      { kanji: "ãƒ­ãƒ“ãƒ¼", hiragana: "ã”ã²ã‚ƒããˆã‚“" },
      { kanji: "å—ä»˜ ã€2èµ¤ã„", hiragana: "ã›ã‚“ãˆã‚“" }
    ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-brian-japanese-6-2026-02-13t13-58-32-102z_RGEWIwXu.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/ee/93/54/ee9354e3cc1f86b258ea55d4b5bd0059.jpg", id: "ä¼šç¤¾" },
    { jp: "https://i.pinimg.com/736x/d3/20/df/d320dfb312273ea98f608771e224b132.jpg", id: "ã‚«ãƒ•ã‚§ " },
    { jp: "https://i.pinimg.com/736x/82/b7/a6/82b7a67994bc19b0c742eb50270382eb.jpg", id: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-emma-japanese-5-2026-02-13t13-37-10-158z_Y0pfXwbu.mp3",
    choices: [
      { kanji: "250å††", hiragana: "ã«ã²ã‚ƒãã”ã˜ã‚…ã†ãˆã‚“" },
      { kanji: "500å††", hiragana: "ã”ã²ã‚ƒããˆã‚“" },
      { kanji: "100å††", hiragana: "ã›ã‚“ãˆã‚“" }
    ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-emma-japanese-6-2026-02-13t14-40-12-606z_Cl77TMYT.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/ef/21/38/ef2138e1b56c57697986f8859f4075e6.jpg", id: "æž—æªŽ" },
    { jp: "https://i.pinimg.com/1200x/24/0c/80/240c8038f9749f24da78544ecbcaa825.jpg", id: "ãƒãƒŠãƒŠ " },
    { jp: "https://i.pinimg.com/736x/95/9c/3e/959c3e1df5d02a5064e77580ba90734a.jpg", id: "ã„ã¡ã”" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-andrew-japanese-5-2026-02-13t15-03-02-237z_AO4WJ6Uq.mp3",
    choices: [
      { kanji: "ï¼‘ç™½ã„ã€ï¼‘èµ¤ã„", hiragana: "ã«ã²ã‚ƒãã”ã˜ã‚…ã†ãˆã‚“" },
      { kanji: "2ç™½ã„ã€1èµ¤ã„", hiragana: "ã”ã²ã‚ƒããˆã‚“" },
      { kanji: "ï¼‘ç™½ã„ã€2èµ¤ã„", hiragana: "ã›ã‚“ãˆã‚“" }
    ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-keita-6-2026-02-13t14-25-59-971z_7KQgFgBM.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/38/81/59/388159d66fefcd2b3e346f812a9b5bd3.jpg", id: "ãã ã‚‚ã®ã‚’ã ã—ã¾ã™" },
    { jp: "https://i.pinimg.com/736x/5f/3a/1f/5f3a1f91ee2b21fe35a40b8be3c1360c.jpg", id: "ã§ã‚“ã’ã‚“ã‚’ãã‚‹ " },
    { jp: "https://i.pinimg.com/1200x/59/80/24/598024829b7840375336b24610ac367d.jpg", id: "ãã ã‚‚ã®ã‚’ ã™ã¦ã¾ã™" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-hyunsu-japanese-6-2026-02-13t10-36-33-199z_5HR7lT9i.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/0d/cc/59/0dcc5941801725922375789ef321aabe.jpg", id: "ã•ã£ã‹ãƒ¼ã‚’ ã™ã‚‹" },
    { jp: "https://i.pinimg.com/1200x/a7/ce/18/a7ce1842a967cefc6702cfdfe47b8fe7.jpg", id: "ã«ã£ãã‚’ ã‹ã" },
    { jp: "https://i.pinimg.com/1200x/4b/ec/1c/4bec1cdebb991b41398d7ed0e7553a97.jpg", id: "ã™ã„ãˆã„ã‚’ ã™ã‚‹" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-brian-japanese-6-2026-02-13t13-58-32-102z_RGEWIwXu.mp3",
    choices: [
      { kanji: "æ°´æ›œæ—¥", hiragana: "ã™ã„ã‚ˆã†ã³" },
      { kanji: "åœŸæ›œæ—¥", hiragana: "ã©ã‚ˆã†ã³" },
      { kanji: "æœ¨æ›œæ—¥", hiragana: "ã‚‚ãã‚ˆã†ã³" }
    ],
  correct: 1
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-keita-6-2026-02-13t12-36-51-996z_fpG1tVQg.mp3",
  choices: [
    { jp: "https://i.pinimg.com/736x/e5/e2/d0/e5e2d0af5780cc0e9fad0af4ddb6c2d6.jpg", id: "ã‚ã‚ã§ã‚‚ ãšã£ã¨ ã ã„ã³ã‚“ãã‚’ ã—ã¾ã—ãŸã€‚" },
    { jp: "https://i.pinimg.com/736x/8a/22/e4/8a22e48cbba5b05e8cd6935e8d149184.jpg", id: "ã ã„ã³ã‚“ãã‚’ ã—ã¦ã‹ã‚‰ã€ãµã­ã« ã®ã‚Šã¾ã—ãŸã€‚" },
    { jp: "https://i.pinimg.com/736x/37/6a/69/376a69dfd1ac45c27a16b4f944c48881.jpg", id: "ã ã„ã³ã‚“ãã¯ ã—ãªã„ã§ã€ãšã£ã¨ ã‹ã„ã‚‚ã®ã‚’ ã—ã¾ã—ãŸã€‚" },
  ],
  correct: 0
},
    {
  text: "Dengarkan baik-baik.",
  audio: "speechma-nanami-6-2026-02-13t09-21-18-727z_aohUEoeR.mp3",
    choices: [
      { kanji: "æœºã®ä¸Š", hiragana: "ã¤ããˆã® ã†ãˆ" },
      { kanji: "æ£š", hiragana: "ãŸãª" },
      { kanji: "å°æ‰€ã®ä¸‹", hiragana: "ã ã„ã©ã“ã‚ã® ã—ãŸ" }
    ],
      correct: 1
    }
  ],

  rea: [
    {
  text: "ã“ã‚Œã¯ ãªã‚“ ã§ã™ã‹ã€‚",
  image: "img/apple.jpg",
  choices: ["ã‚Šã‚“ã”", "ã¿ã‹ã‚“", "ã°ãªãª", "ã¶ã©ã†"],
  correct: 1
},
    {
      text: "ã“ã‚“ã°ã‚“ ______ã€‚",
      choices: ["ã¯", "ã‚’", "ã«", "ã§"],
      correct: 1
    }
  ]
};
// ðŸ”€ ACAK SOAL + PILIHAN JAWABAN (SEKALI SAJA)
for (let key in sections) {
  shuffleArray(sections[key]);       // acak urutan soal

  sections[key].forEach(q => {
    shuffleChoices(q);               // ðŸ”¥ acak pilihan jawaban
  });
}
let currentSection = "gra";
let currentQuestion = 0;
// simpan jawaban user
let answered = {
  gra: new Array(sections.gra.length).fill(null),
  scri: new Array(sections.scri.length).fill(null),
  co: new Array(sections.co.length).fill(null),
  list: new Array(sections.list.length).fill(null),
  rea: new Array(sections.rea.length).fill(null)
};

let totalScore = 0;              // âœ… global
const POINT_PER_QUESTION = 10;   // âœ… global

function goToSection(sectionKey) {
  if (currentSection === sectionKey) return; // â›” stop

  currentSection = sectionKey;
  currentQuestion = 0;

  if (!answered[sectionKey].length) {
    answered[sectionKey] =
      new Array(sections[sectionKey].length).fill(null);
  }

  document.getElementById("intro").classList.remove("active");
  document.getElementById("quiz").classList.add("active");

  loadQuestion();
  renderSteps();
  updateSideProgress();
}

  // ðŸ‘‰ pindah soal berdasarkan nomor step
function goToQuestion(index) {
  currentQuestion = index;

  document.getElementById("intro").classList.remove("active");
  document.getElementById("quiz").classList.add("active");

  loadQuestion();
  renderSteps();
}

function loadQuestion() {
  const q = sections[currentSection][currentQuestion];

  document.getElementById("qNumber").textContent =
    `Question ${currentQuestion + 1} / ${sections[currentSection].length}`;

const questionText = document.getElementById("questionText");
questionText.textContent = renderQuestionText(q);
questionText.style.whiteSpace = "pre-line"; // ðŸ”¥ INI KUNCINYA

  document.getElementById("examSection").textContent =
    currentSection.toUpperCase();

  document.getElementById("examProgress").textContent =
    `Question ${currentQuestion + 1} / ${sections[currentSection].length}`;


  // ===== IMAGE =====
  const imageBox = document.getElementById("imageContainer");
  imageBox.innerHTML = "";
  // ===== FIX EMPTY IMAGE SPACE (MOBILE ONLY) =====
const container = document.querySelector(".container");

// reset dulu
container.classList.remove("no-image-question");

if (!q.image) {
  container.classList.add("no-image-question");
}
  if (q.image) {
    const img = document.createElement("img");
    img.src = q.image;
    imageBox.appendChild(img);
  }

// ===== AUDIO =====
const audioBox = document.getElementById("audioContainer");
audioBox.innerHTML = "";

if (q.audio) {
  const qIndex = currentQuestion;

  // init kalau belum ada
  if (audioPlaysPerQuestion[qIndex] === undefined) {
    audioPlaysPerQuestion[qIndex] = 0;
  }

  // ðŸ”’ kalau soal ini sudah habis jatahnya
  if (audioPlaysPerQuestion[qIndex] >= MAX_AUDIO_PLAY) {
    audioBox.innerHTML = `
      <div style="color:#888;font-size:12px;opacity:.6">
        Audio sudah diputar 2x
      </div>
    `;
    return;
  }

const audio = document.createElement("audio");
audio.src = q.audio;
audio.controls = true;
audio.controlsList = "nodownload noplaybackrate"; // ðŸ”¥ penting
audio.preload = "auto";

audio.addEventListener("ended", () => {
  audioPlaysPerQuestion[qIndex]++;

  if (audioPlaysPerQuestion[qIndex] >= MAX_AUDIO_PLAY) {
    audio.pause();
    audio.removeAttribute("controls");
    audio.src = "";
    audio.load();

    audio.style.pointerEvents = "none";
    audio.style.opacity = "0.4";

    audioBox.insertAdjacentHTML(
      "beforeend",
      "<div style='color:#888;font-size:12px'>Batas audio tercapai</div>"
    );
  }
});
  audioBox.appendChild(audio);
}

  // ===== CHOICES =====
const choicesEl = document.getElementById("choices");
choicesEl.innerHTML = "";

/* ðŸ”¥ RESET CLASS */
choicesEl.className = "choices";

/* ðŸ”¥ CEK APAKAH PILIHAN GAMBAR */
if (
  q.choices &&
  typeof q.choices[0] === "object" &&
  (q.choices[0].img || q.choices[0].jp)
) {
  choicesEl.className = "choices image-grid";
}

q.choices.forEach((choice, i) => {
  const btn = document.createElement("button");
  btn.onclick = () => checkAnswer(i);

  // ðŸ”¹ PILIHAN DENGAN GAMBAR
// ðŸ”¹ JAWABAN GAMBAR
if (typeof choice === "object" && (choice.img || choice.jp)) {

  // 1. bikin kotak gambar
  const box = document.createElement("div");
  box.className = "choice-img-box";

  // 2. bikin elemen <img>
  const img = document.createElement("img");
img.src = choice.img || choice.jp;
  img.alt = "choice image";

  // 3. masukin img ke kotak
  box.appendChild(img);

  // 4. masukin kotak ke tombol
  btn.appendChild(box);

  // 5. label (A, B, C, D)
  if (choice.label) {
    const label = document.createElement("div");
    label.className = "choice-label";
    label.textContent = choice.label;
    btn.appendChild(label);
  }
}

  // ðŸ”¹ PILIHAN TEKS BIASA
  else {
    btn.textContent = choice;
  }

  choicesEl.appendChild(btn);
});

const saved = answered[currentSection][currentQuestion];
if (saved !== null) {
  const buttons = document.querySelectorAll("#choices button");
  buttons[saved].classList.add("selected");
}
  document.getElementById("result").textContent = "";
}

function checkAnswer(choice) {

  const q = sections[currentSection][currentQuestion];
  const previous = answered[currentSection][currentQuestion];

  // kurangi skor jika sebelumnya benar
  if (previous === q.correct) {
    totalScore -= POINT_PER_QUESTION;
  }

  // tambah skor jika sekarang benar
  if (choice === q.correct) {
    totalScore += POINT_PER_QUESTION;
  }

  answered[currentSection][currentQuestion] = choice;

  const buttons = document.querySelectorAll("#choices button");
  buttons.forEach(btn => btn.classList.remove("selected"));
  buttons[choice].classList.add("selected");

  updateSideProgress();
  renderSteps();

  if (checkAllFinished()) {
    showResult();
  }
}

function updateSideProgress() {

  let answeredCount = 0;
  let total = sections[currentSection].length;

  answered[currentSection].forEach(v => {
    if (v !== null) answeredCount++;
  });

  let percent = (answeredCount / total) * 100;
  const fill = document.getElementById(currentSection + "Progress");

  if (window.innerWidth <= 768) {
    fill.style.width = percent + "%";
    fill.style.height = "100%";
  } else {
    fill.style.height = percent + "%";
    fill.style.width = "100%";
  }
}


function nextQuestion() {
  if (currentQuestion < sections[currentSection].length - 1) {
    currentQuestion++;
    loadQuestion();
    renderSteps();
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    loadQuestion();
    renderSteps();
  }
}

function goToIntro() {
  document.getElementById("intro").classList.add("active");
  document.getElementById("quiz").classList.remove("active");

  // matikan highlight step
  document.querySelectorAll(".step")
    .forEach(s => s.classList.remove("active"));
}

function renderSteps() {
  const stepColumn = document.getElementById("stepColumn");
  stepColumn.innerHTML = "";

  sections[currentSection].forEach((_, index) => {
    const step = document.createElement("div");
    step.className = "step";
    step.textContent = index + 1;

    if (answered[currentSection][index] !== null) {
  step.classList.add("answered");
}

    if (index === currentQuestion) {
      step.classList.add("active");
    }

    step.onclick = () => goToQuestion(index);

    stepColumn.appendChild(step);
  });
}
window.addEventListener("DOMContentLoaded", () => {

  // matikan semua screen
  document.querySelectorAll(".screen").forEach(s =>
    s.classList.remove("active")
  );

  // aktifkan quiz
  document.getElementById("quiz").classList.add("active");

  // set awal
  currentSection = "gra";
  currentQuestion = 0;   // ðŸ”¥ NAMA BENAR

  // render awal
  renderSteps();
  loadQuestion();
  updateSideProgress();
});
function checkAllFinished() {
  for (let key in sections) {
    if (answered[key].length === 0) return false;
    if (answered[key].includes(null)) return false;
  }
  return true;
}

function showResult() {

  // ===== HITUNG SKOR (TETAP) =====
  let totalCorrect = 0;
  let totalQuestions = 0;
  let sectionHTML = "";

  for (let key in sections) {
    let correct = 0;
    sections[key].forEach((q, i) => {
      if (answered[key][i] === q.correct) correct++;
    });

    let percent = Math.round((correct / sections[key].length) * 100);
    totalCorrect += correct;
    totalQuestions += sections[key].length;

    sectionHTML += `
      <div class="section-item">
        <span>${key.toUpperCase()}</span>
        <div class="percent-bar">
          <div class="percent-fill" style="width:${percent}%"></div>
        </div>
        <div class="percent-text">${percent}%</div>
      </div>
    `;
  }

  let maxScore = totalQuestions * POINT_PER_QUESTION;
  let totalPercent = Math.round((totalScore / maxScore) * 100);
  let score250 = Math.round((totalScore / maxScore) * 250);

  document.getElementById("totalScoreText").textContent =
    `Total Score: ${score250} points`;

  document.getElementById("scoreMarker").style.left =
    totalPercent + "%";

  document.getElementById("sectionScores").innerHTML =
    sectionHTML;

  // ===== ðŸ”¥ INI KUNCI UTAMA ðŸ”¥ =====
document.getElementById("quiz").classList.remove("active");
document.getElementById("resultScreen").classList.add("active");
document.body.classList.add("result-mode");
}

</script>

</body>
</html>
